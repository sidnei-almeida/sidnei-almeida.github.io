<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  
  <!-- Chart.js para gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Sortable.js para arrastar e soltar no Kanban -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  
  <title>Agile Mini - Gestão de Projetos Ágeis</title>
  <meta name="description" content="Sistema de gestão de projetos ágeis com Kanban, Burndown e Velocity" />
  
  <style>
    /* Estilos gerais do Agile Mini */
    .agile-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      color: var(--white-1);
    }
    
    .agile-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 1.5rem;
    }
    
    .agile-title {
      font-size: 3.2rem;
      color: var(--white);
    }
    
    .agile-subtitle {
      font-size: 1.6rem;
      color: var(--white-1);
      opacity: 0.8;
      margin-top: 0.5rem;
    }
    
    .agile-nav {
      display: flex;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 2rem;
    }
    
    .agile-nav-item {
      padding: 1.2rem 2.5rem;
      cursor: pointer;
      font-size: 1.6rem;
      transition: all 0.3s;
      border: none;
      background: transparent;
      color: var(--white-1);
    }
    
    .agile-nav-item.active {
      background: var(--pink);
      color: white;
    }
    
    .agile-nav-item:hover:not(.active) {
      background: rgba(213, 0, 50, 0.2);
    }
    
    .agile-view {
      display: none;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      padding: 2rem;
      min-height: 500px;
    }
    
    .agile-view.active {
      display: block;
    }
    
    .agile-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .agile-button {
      background: var(--pink);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.4rem;
      transition: all 0.3s;
    }
    
    .agile-button:hover {
      background: #b5002a;
    }
    
    .agile-button.secondary {
      background: rgba(255,255,255,0.1);
    }
    
    .agile-button.secondary:hover {
      background: rgba(255,255,255,0.2);
    }
    
    /* Estilos do Kanban */
    .kanban-board {
      display: flex;
      gap: 2rem;
      margin-top: 2rem;
      overflow-x: auto;
      padding-bottom: 1rem;
    }
    
    .kanban-column {
      flex: 1;
      min-width: 300px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1.5rem;
    }
    
    .kanban-column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .kanban-column-title {
      font-size: 1.8rem;
      font-weight: 500;
    }
    
    .kanban-column-count {
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 0.3rem 1rem;
      font-size: 1.4rem;
    }
    
    .kanban-task-list {
      min-height: 200px;
    }
    
    .kanban-task {
      background: rgba(30,30,30,0.9);
      border-radius: 6px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      cursor: grab;
      transition: all 0.2s;
      border-left: 3px solid var(--pink);
    }
    
    .kanban-task:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .kanban-task-title {
      font-size: 1.6rem;
      margin-bottom: 0.8rem;
      font-weight: 500;
    }
    
    .kanban-task-desc {
      font-size: 1.4rem;
      opacity: 0.7;
      margin-bottom: 1.2rem;
    }
    
    .kanban-task-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.2rem;
      opacity: 0.6;
    }
    
    .kanban-task-priority {
      display: inline-block;
      padding: 0.2rem 0.8rem;
      border-radius: 4px;
      font-size: 1.2rem;
    }
    
    .priority-alta {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    .priority-media {
      background: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }
    
    .priority-baixa {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .kanban-task-points {
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    /* Botão Home */
    .home {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: var(--pink);
        border: none;
        cursor: pointer;
        z-index: 9999;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .home img {
        width: 24px;
        height: 24px;
        transition: filter 0.3s ease;
    }
    .home:hover {
        background-color: transparent;
        border: 1px solid var(--pink);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .home:hover img {
        filter: brightness(0) saturate(100%) invert(27%) sepia(51%) saturate(2878%) hue-rotate(330deg) brightness(104%) contrast(97%);
    }
    .home:active {
        transform: scale(0.95);
        border: 1px solid var(--pink);
    }
    
    /* Botão Excel */
    .btn-download-excel {
      display: inline-flex;
      align-items: center;
      gap: 0.4em;
      background: #43a047;
      color: white;
      padding: 0.5em 1em;
      border-radius: 4px;
      border: none;
      font-size: 0.9em;
      cursor: pointer;
      font-family: 'Jost', sans-serif;
      transition: background 0.2s;
    }
    .btn-download-excel:hover {
      background: #2e7d32;
    }
    
    /* Botu00f5es de navegau00e7u00e3o */
    .nav-btn {
      margin-left: 0.5em;
    }
    .nav-btn:hover {
      background-color: transparent !important;
      border: 1px solid var(--pink);
      color: var(--white-1) !important;
    }
    
    /* Tabela Ementas */
    .noticias-table tr.ementa-selecionada {
      background: rgba(213, 0, 50, 0.08) !important;
    }
    
    /* Checkbox estilizado */
    .ementa-checkbox {
      appearance: none;
      -webkit-appearance: none;
      width: 17px;
      height: 17px;
      border: 1.5px solid rgba(213, 0, 50, 0.6);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
      background-color: transparent;
      position: relative;
      vertical-align: middle;
      margin: 0;
      transition: background-color 0.2s ease, border 0.2s ease, box-shadow 0.2s ease;
    }
    
    .ementa-checkbox:checked {
      background-color: var(--pink);
      border-color: var(--pink);
    }
    
    .ementa-checkbox:checked::after {
      content: '';
      position: absolute;
      left: 6px;
      top: 3px;
      width: 4px;
      height: 7px;
      border: solid white;
      border-width: 0 1.5px 1.5px 0;
      transform: rotate(45deg);
    }
    
    .ementa-checkbox:hover {
      border-color: var(--pink);
      box-shadow: 0 0 0 2px rgba(213,0,50,0.15);
    }
    
    .ementa-checkbox:focus {
      box-shadow: 0 0 0 3px rgba(213,0,50,0.25);
    }
    
    /* Links da tabela */
    .ementa-link {
      color: var(--pink);
      text-decoration: none;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    
    .ementa-link:hover {
      text-decoration: underline;
      opacity: 0.9;
    }
    
    /* Popup de Ementa */
    .ementa-popup-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2em;
      box-sizing: border-box;
    }
    .ementa-popup-box {
      background: #242323;
      border-radius: 8px;
      max-width: 800px;
      width: 100%;
      padding: 1.5em;
      position: relative;
      max-height: 80vh;
      overflow-y: auto;
    }
    .ementa-popup-fechar {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      color: var(--pink);
      font-size: 1.5em;
      cursor: pointer;
    }
    .ementa-popup-titulo {
      font-size: 1.2em;
      color: var(--pink);
      margin-bottom: 1em;
      font-family: 'Jost', sans-serif;
    }
    
    /* Cartões de Resultados */
    .ementa-trunc {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      max-width: 90%;
      font-size: 0.71em;
      line-height: 1.20;
      position: relative;
    }
    .ver-mais {
      font-size: 0.68em !important;
      color: var(--pink);
      cursor: pointer;
      font-weight: bold;
      display: inline-block;
      position: absolute;
      right: 0.08em;
      bottom: 0.05em;
      background: transparent;
      padding: 0 0.12em;
      margin: 0;
      line-height: Z1.1;
      z-index: 1;
      vertical-align: baseline;
    }
    .ver-mais:hover { 
      text-decoration: underline; 
    }
    .cards-rotulo {
      display: flex;
      flex-wrap: wrap;
      gap: 1.2em 2%;
      margin-top: 1em;
      align-items: stretch;
      justify-content: flex-start;
      width: 100%;
      box-sizing: border-box;
      padding: 0;
    }
    .card-rotulo {
      background: transparent;
      border-radius: 7px;
      box-shadow: none;
      padding: 1.1em 1.1em 1.2em 1.1em;
      width: 23.5%; /* Aproximadamente 1/4 com gap */
      min-width: 220px;
      max-width: 25%;
      box-sizing: border-box;
      margin-bottom: 1.5em;
      display: flex;
      flex-direction: column;
      position: relative;
      border: 1.5px solid var(--pink);
      min-height: 11rem;
      color: var(--white-1);
    }
    @media (max-width: 1100px) {
      .card-rotulo {
        width: 48%;
        max-width: 48%;
      }
    }
    @media (max-width: 700px) {
      .card-rotulo {
        width: 100%;
        max-width: 100%;
      }
      .cards-rotulo {
        gap: 1em 0;
      }
    }
    /* Nenhum efeito de hover nos cards */
    .rotulo-header {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.5em;
      margin-bottom: 0.5em;
      font-size: 0.8em;
      color: #aaa;
    }
    .rotulo-id {
      padding: 0.1em 0.4em;
      background: rgba(230,0,122,0.07);
      border-radius: 3px;
      color: var(--pink);
      font-size: 0.85em;
    }
    .rotulo-tipo {
      color: #aaa;
      font-size: 0.85em;
    }
    .rotulo-ementa {
      margin-bottom: 0.7em;
      color: var(--white-1);
      flex-grow: 1;
      position: relative;
    }
    .rotulo-class {
      align-self: flex-start;
      margin-top: auto;
      padding: 0.15em 0.75em;
      border-radius: 5px;
      display: inline-block;
      font-weight: 500;
      color: white;
      font-size: 0.84em;
      background: #43a047;
    }
    .rotulo-class--direita { background: #43a047; }
    .rotulo-class--esquerda { background: #f44336; }
    .rotulo-class--centro { background: #3f51b5; }
    .rotulo-class--tecnicos { background: #ff9800; }
    .rotulo-link {
      color: var(--pink);
      text-decoration: none;
      font-size: 0.75em;
      margin-top: 0.5em;
      display: inline-block;
      align-self: flex-end;
    }
    .rotulo-link:hover {
      text-decoration: underline;
    }
    
    /* Mensagens de aviso */
    .aviso-verde {
      color: #4caf50;
      background: rgba(76,175,80,0.08);
      border-radius: 5px;
      padding: 0.6em 0.8em;
      font-size: 0.95em;
      margin-bottom: 1em;
      display: flex;
      align-items: center;
      gap: 0.4em;
    }
    .aviso-erro {
      color: #f44336;
      background: rgba(244,67,54,0.08);
      border-radius: 5px;
      padding: 0.6em 0.8em;
      font-size: 0.95em;
      margin-bottom: 1em;
      display: flex;
      align-items: center;
      gap: 0.4em;
    }
    .aviso-sucesso {
      color: #4caf50;
      background: rgba(76,175,80,0.08);
      border-radius: 5px;
      padding: 0.6em 0.8em;
      font-size: 0.95em;
      margin-bottom: 1em;
      display: flex;
      align-items: center;
      gap: 0.4em;
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
      .cards-rotulo {
        flex-direction: column;
        align-items: center;
      }
      .card-rotulo {
        width: 100%;
      }
    }
    
    /* Estilos para projetos */
    .project-sprint-item {
      background: rgba(30,30,30,0.6);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    
    /* Estilos para a grade de projetos */
    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .project-card {
      background: rgba(255,255,255,0.07);
      border-radius: 8px;
      padding: 2rem;
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      flex-direction: column;
    }
    
    .project-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .project-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.5rem;
    }
    
    .project-card h3 {
      font-size: 2rem;
      margin: 0;
      color: var(--white);
      flex: 1;
    }
    
    .project-status {
      font-size: 1.2rem;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
    }
    
    .project-status.active {
      background: rgba(0, 200, 83, 0.2);
      color: #00c853;
    }
    
    .project-status.paused {
      background: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }
    
    .project-status.completed {
      background: rgba(0, 149, 255, 0.2);
      color: #0095ff;
    }
    
    .project-description {
      margin: 0 0 1.5rem 0;
      color: var(--white-2);
      flex-grow: 1;
    }
    
    .project-dates {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
      color: var(--white-2);
    }
    
    .project-progress {
      margin-bottom: 1.5rem;
    }
    
    .progress-bar {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, var(--pink), #ff5773);
    }
    
    .project-actions {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
    }
    
    .project-actions button {
      flex: 1;
      padding: 0.8rem;
    }
    
    .empty-state {
      padding: 4rem 2rem;
      text-align: center;
      color: var(--white-2);
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    
    .loading-state {
      padding: 4rem 2rem;
      text-align: center;
      color: var(--white-2);
    }
    
    .project-sprint-item {
      border-left: 4px solid var(--pink);
    }
    
    .project-task-item {
      background: rgba(30,30,30,0.6);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #4caf50;
    }
    
    .project-task-item.to\ do {
      border-left-color: #f44336;
    }
    
    .project-task-item.doing {
      border-left-color: #ff9800;
    }
    
    .project-task-item.done {
      border-left-color: #4caf50;
    }
    
    .task-header, .sprint-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .task-header h4, .sprint-header h4 {
      margin: 0;
      font-size: 1.6rem;
      font-weight: 500;
    }
    
    .task-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      font-size: 1.2rem;
      color: var(--white-2);
    }
    
    .task-priority, .sprint-status, .task-status {
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      font-size: 1.2rem;
    }
    
    .task-priority.alta {
      background: rgba(244,67,54,0.2);
      color: #f44336;
    }
    
    .task-priority.média {
      background: rgba(255,152,0,0.2);
      color: #ff9800;
    }
    
    .task-priority.baixa {
      background: rgba(76,175,80,0.2);
      color: #4caf50;
    }
    
    .sprint-status.ativo {
      background: rgba(33,150,243,0.2);
      color: #2196f3;
    }
    
    .sprint-status.concluído {
      background: rgba(76,175,80,0.2);
      color: #4caf50;
    }
    
    .sprint-status.planejado {
      background: rgba(156,39,176,0.2);
      color: #9c27b0;
    }
    
    .sprint-dates {
      font-size: 1.2rem;
      color: var(--white-2);
    }
    
    /* Estilos para gráficos */
    .chart-container {
      background: rgba(30,30,30,0.6);
      border-radius: 8px;
      padding: 2rem;
      margin-top: 2rem;
      height: 400px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .chart-title {
      font-size: 2rem;
      font-weight: 500;
    }
    
    .sprint-selector {
      background: rgba(255,255,255,0.1);
      border: none;
      color: var(--white-1);
      padding: 0.8rem 1.5rem;
      border-radius: 4px;
      font-size: 1.4rem;
    }
    
    .sprint-selector option {
      background: #222;
    }
    
    /* Estilos para formulários */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.8rem;
      font-size: 1.4rem;
    }
    
    .form-input {
      width: 100%;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--white);
      padding: 1rem;
      border-radius: 4px;
      font-size: 1.4rem;
    }
    
    .form-select {
      width: 100%;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--white);
      padding: 1rem;
      border-radius: 4px;
      font-size: 1.4rem;
    }
    
    .form-select option {
      background: #222;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 2rem;
    }
    
    /* Estilos para modais */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: #1a1a1a;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 2.5rem;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .modal-title {
      font-size: 2.2rem;
      font-weight: 500;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--white-1);
      font-size: 2.2rem;
      cursor: pointer;
      opacity: 0.7;
      transition: all 0.3s;
    }
    
    .modal-close:hover {
      opacity: 1;
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
      .kanban-board {
        flex-direction: column;
      }
      
      .kanban-column {
        min-width: 100%;
      }
      
      .agile-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .agile-nav {
        margin-top: 1.5rem;
        width: 100%;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <div class="agile-container">
    <div class="agile-header">
      <div>
        <h1 class="agile-title">Agile Mini</h1>
        <p class="agile-subtitle">Sistema de gestão de projetos ágeis</p>
      </div>
    </div>
    
    <div class="agile-nav">
      <button class="agile-nav-item active" data-view="projects">
        <i class="fas fa-project-diagram"></i> Projetos
      </button>
      <button class="agile-nav-item" data-view="sprints">
        <i class="fas fa-flag"></i> Sprints
      </button>
      <button class="agile-nav-item" data-view="tasks">
        <i class="fas fa-tasks"></i> Tarefas
      </button>
      <button class="agile-nav-item" data-view="kanban">
        <i class="fas fa-columns"></i> Kanban
      </button>
      <button class="agile-nav-item" data-view="burndown">
        <i class="fas fa-chart-line"></i> Burndown
      </button>
      <button class="agile-nav-item" data-view="velocity">
        <i class="fas fa-tachometer-alt"></i> Velocity
      </button>
    </div>
    
    <!-- View: Kanban -->
    <div id="kanbanView" class="agile-view active">
      <div class="agile-card">
        <div class="form-group" style="display: flex; gap: 1rem; align-items: center;">
          <div style="flex: 1;">
            <label class="form-label" for="sprintFilter">Sprint</label>
            <select id="sprintFilter" class="form-select">
              <option value="">Todos os Sprints</option>
              <!-- Sprints serão carregados via JavaScript -->
            </select>
          </div>
          <div style="flex: 1;">
            <label class="form-label" for="projectFilter">Projeto</label>
            <select id="projectFilter" class="form-select">
              <option value="">Todos os Projetos</option>
              <!-- Projetos serão carregados via JavaScript -->
            </select>
          </div>
          <div style="flex: 0.5;">
            <label class="form-label" for="priorityFilter">Prioridade</label>
            <select id="priorityFilter" class="form-select">
              <option value="">Todas</option>
              <option value="Alta">Alta</option>
              <option value="Média">Média</option>
              <option value="Baixa">Baixa</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="kanban-board">
        <!-- Coluna: A Fazer -->
        <div class="kanban-column" id="todoColumn">
          <div class="kanban-column-header">
            <h3 class="kanban-column-title">A Fazer</h3>
            <span class="kanban-column-count" id="todoCount">0</span>
          </div>
          <div class="kanban-task-list" id="todoList">
            <!-- Tarefas serão carregadas via JavaScript -->
          </div>
        </div>
        
        <!-- Coluna: Em Andamento -->
        <div class="kanban-column" id="doingColumn">
          <div class="kanban-column-header">
            <h3 class="kanban-column-title">Em Andamento</h3>
            <span class="kanban-column-count" id="doingCount">0</span>
          </div>
          <div class="kanban-task-list" id="doingList">
            <!-- Tarefas serão carregadas via JavaScript -->
          </div>
        </div>
        
        <!-- Coluna: Concluído -->
        <div class="kanban-column" id="doneColumn">
          <div class="kanban-column-header">
            <h3 class="kanban-column-title">Concluído</h3>
            <span class="kanban-column-count" id="doneCount">0</span>
          </div>
          <div class="kanban-task-list" id="doneList">
            <!-- Tarefas serão carregadas via JavaScript -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- View: Burndown -->
    <div id="burndownView" class="agile-view">
      <div class="agile-card">
        <div class="form-group">
          <label class="form-label" for="burndownSprintSelect">Selecione o Sprint</label>
          <select id="burndownSprintSelect" class="form-select">
            <!-- Sprints serão carregados via JavaScript -->
          </select>
        </div>
      </div>
      
      <div class="chart-container">
        <div class="chart-header">
          <h3 class="chart-title">Burndown Chart</h3>
          <div>
            <button id="toggleBurndownView" class="agile-button secondary">
              <i class="fas fa-exchange-alt"></i> Tarefas/Pontos
            </button>
          </div>
        </div>
        <canvas id="burndownChart"></canvas>
      </div>
    </div>
    
    <!-- View: Velocity -->
    <div id="velocityView" class="agile-view">
      <div class="agile-card">
        <div class="chart-container">
          <div class="chart-header">
            <h2 class="chart-title">Velocity Chart</h2>
          </div>
          <canvas id="velocityChart"></canvas>
        </div>
      </div>
    </div>
    
    <!-- View: Projects -->
    <div id="projectsView" class="agile-view active">
      <div class="agile-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
          <h2 class="chart-title">Projetos</h2>
          <button id="btnAddProject" class="agile-button">
            <i class="fas fa-plus"></i> Novo Projeto
          </button>
        </div>
        
        <!-- Lista de projetos com cards -->
        <div id="projectsList" class="projects-grid">
          <!-- Projetos serão carregados via JavaScript -->
          <div class="loading-state">Carregando projetos...</div>
        </div>
      </div>
      
      <!-- Visualização detalhada de projeto selecionado -->
      <div id="projectViewDetails" class="agile-card" style="display: none; margin-top: 2rem;">
        <div class="form-group" style="display: flex; gap: 1rem; align-items: center;">
          <div style="flex: 1;">
            <label class="form-label" for="projectSelector">Projeto</label>
            <select id="projectSelector" class="form-select" data-type="project-selector">
              <option value="">Selecione um projeto</option>
            </select>
          </div>
        </div>
        
        <div id="projectDetails" style="margin-top: 2rem; display: none;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div>
              <h2 id="projectName" class="chart-title" style="margin-bottom: 1rem;"></h2>
              <p id="projectDescription" style="color: var(--white-2);"></p>
              <div style="display: flex; gap: 1.5rem; margin-top: 1rem; color: var(--white-2);">
                <div id="projectStartDateDisplay">
                  <i class="fas fa-calendar-day"></i> Início: <span>Não definido</span>
                </div>
                <div id="projectEndDateDisplay">
                  <i class="fas fa-calendar-check"></i> Término: <span>Não definido</span>
                </div>
              </div>
            </div>
            <div>
              <button id="btnAddTaskInProject" class="agile-button">
                <i class="fas fa-plus"></i> Nova Tarefa
              </button>
              <button id="btnAddSprintInProject" class="agile-button secondary">
                <i class="fas fa-flag"></i> Novo Sprint
              </button>
            </div>
          </div>
          
          <div style="margin-bottom: 2rem;">
            <h3 style="font-size: 1.8rem; margin-bottom: 1rem;">Sprints</h3>
            <div id="projectSprints" class="project-sprints">
              <div class="loading">Carregando sprints...</div>
            </div>
          </div>
          
          <div>
            <h3 style="font-size: 1.8rem; margin-bottom: 1rem;">Tarefas</h3>
            <div id="projectTasks" class="project-tasks">
              <div class="loading">Carregando tarefas...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal: Nova Tarefa -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="taskModalTitle">Nova Tarefa</h2>
        <button class="modal-close" id="closeTaskModal">&times;</button>
      </div>
      <form id="taskForm">
        <input type="hidden" id="taskId" value="">
        <div class="form-group">
          <label class="form-label" for="taskTitle">Título</label>
          <input type="text" id="taskTitle" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskDescription">Descrição</label>
          <textarea id="taskDescription" class="form-input" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskStatus">Status</label>
          <select id="taskStatus" class="form-select" required>
            <option value="A Fazer">A Fazer</option>
            <option value="Em Andamento">Em Andamento</option>
            <option value="Concluído">Concluído</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskProject">Projeto</label>
          <select id="taskProject" class="form-select">
            <option value="">Selecione um projeto</option>
            <!-- Projetos serão carregados via JavaScript -->
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskSprint">Sprint</label>
          <select id="taskSprint" class="form-select">
            <option value="">Selecione um sprint</option>
            <!-- Sprints serão carregados via JavaScript -->
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskPoints">Points</label>
          <select id="taskPoints" class="form-select">
            <option value="">Selecione</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="5">5</option>
            <option value="8">8</option>
            <option value="13">13</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="taskPriority">Prioridade</label>
          <select id="taskPriority" class="form-select" required>
            <option value="Baixa">Baixa</option>
            <option value="Média" selected>Média</option>
            <option value="Alta">Alta</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" id="cancelTaskBtn" class="agile-button secondary">Cancelar</button>
          <button type="submit" class="agile-button">Salvar</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Modal: Novo Sprint -->
  <div id="sprintModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Novo Sprint</h2>
        <button class="modal-close" id="closeSprintModal">&times;</button>
      </div>
      <form id="sprintForm">
        <div class="form-group">
          <label class="form-label" for="sprintName">Nome do Sprint</label>
          <input type="text" id="sprintName" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="sprintProject">Projeto</label>
          <select id="sprintProject" class="form-select">
            <option value="">Selecione um projeto</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="sprintStartDate">Data de Início</label>
          <input type="date" id="sprintStartDate" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="sprintEndDate">Data de Término</label>
          <input type="date" id="sprintEndDate" class="form-input" required>
        </div>
        <div class="form-actions">
          <button type="button" id="cancelSprintBtn" class="agile-button secondary">Cancelar</button>
          <button type="submit" class="agile-button">Criar Sprint</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Modal: Novo Projeto -->
  <div id="projectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Novo Projeto</h2>
        <button class="modal-close" id="closeProjectModal">&times;</button>
      </div>
      <form id="projectForm">
        <div class="form-group">
          <label class="form-label" for="projectNameInput">Nome do Projeto</label>
          <input type="text" id="projectNameInput" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="projectDescription">Descrição</label>
          <textarea id="projectDescription" class="form-input" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="projectStatus">Status</label>
          <select id="projectStatus" class="form-select">
            <option value="Ativo">Ativo</option>
            <option value="Pausado">Pausado</option>
            <option value="Concluído">Concluído</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="projectStartDate">Data de Início</label>
          <input type="date" id="projectStartDate" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label" for="projectEndDate">Data de Término Prevista</label>
          <input type="date" id="projectEndDate" class="form-input">
        </div>
        <div class="form-actions">
          <button type="button" id="cancelProjectBtn" class="agile-button secondary">Cancelar</button>
          <button type="submit" class="agile-button">Criar Projeto</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Botão Home -->
  <a href="index.html" class="home">
    <i class="fas fa-home" style="color: white; font-size: 2rem;"></i>
  </a>
  
  <script>
    // Configuração da API
    const API_URL = 'http://127.0.0.1:8000';  // URL local para desenvolvimento
    
    // Estado da aplicação
    let tasks = [];
    let sprints = [];
    let projects = [];
    let currentView = 'kanban';
    let burndownMode = 'tasks'; // 'tasks' ou 'points'
    let velocityMode = 'tasks'; // 'tasks' ou 'points'
    let burndownChart = null;
    let velocityChart = null;
    let currentProjectId = null;
    let editingTaskId = null;
    
    // Funções utilitárias
    function openModal(modal) {
      if (!modal) return;
      modal.classList.add('active');
    }
    
    function closeModal(modal) {
      if (!modal) return;
      modal.classList.remove('active');
    }
    
    function showMessage(message, type = 'info') {
      const messageEl = document.createElement('div');
      messageEl.className = type === 'error' ? 'aviso-erro' : 'aviso-sucesso';
      messageEl.innerHTML = `<i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i> ${message}`;
      
      const container = document.querySelector('.agile-container');
      if (container) {
        container.insertBefore(messageEl, container.firstChild);
        
        setTimeout(() => {
          messageEl.remove();
        }, 5000);
      }
    }
    
    function formatDate(dateString) {
      if (!dateString) return '';
      
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return dateString;
      
      return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }
    
    // Elementos DOM
    const taskModal = document.getElementById('taskModal');
    const sprintModal = document.getElementById('sprintModal');
    const projectModal = document.getElementById('projectModal');
    const taskForm = document.getElementById('taskForm');
    const sprintForm = document.getElementById('sprintForm');
    const projectForm = document.getElementById('projectForm');
    const sprintFilter = document.getElementById('sprintFilter');
    const projectFilter = document.getElementById('projectFilter');
    const statusFilter = document.getElementById('statusFilter');
    const priorityFilter = document.getElementById('priorityFilter');
    const burndownSprintSelect = document.getElementById('burndownSprintSelect');
    const toggleBurndownView = document.getElementById('toggleBurndownView');
    const toggleVelocityView = document.getElementById('toggleVelocityView');
    const navItems = document.querySelectorAll('.agile-nav-item');
    const views = document.querySelectorAll('.agile-view');
    
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', init);
    
    async function init() {
      // Configura eventos
      setupEventListeners();
      
      // Carrega dados iniciais
      await Promise.all([
        loadSprints(),
        loadProjects(),
        loadTasks()
      ]);
      
      // Inicializa Sortable.js para as listas do Kanban
      initKanbanSortable();
      
      // Inicializa gráficos
      initCharts();
    }
    
    // Função para formatar datas
    function formatDate(dateString) {
      if (!dateString) return '';
      
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return dateString;
      
      return date.toLocaleDateString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }
    
    function setupEventListeners() {
      // Botão para criar novo projeto
      const btnAddProject = document.getElementById('btnAddProject');
      if (btnAddProject) {
        btnAddProject.addEventListener('click', () => {
          openModal(projectModal);
          // Limpar formulário
          document.getElementById('projectForm').reset();
        });
      }
      
      // Formulário de projetos
      const projectForm = document.getElementById('projectForm');
      if (projectForm) {
        projectForm.addEventListener('submit', handleProjectSubmit);
      }
      
      // Fechar modal de projeto
      const closeProjectModal = document.getElementById('closeProjectModal');
      
      if (closeProjectModal) {
        closeProjectModal.addEventListener('click', () => closeModal(projectModal));
      }
      
      // Botões dentro da visualização de projetos
      const btnAddTaskInProject = document.getElementById('btnAddTaskInProject');
      const btnAddSprintInProject = document.getElementById('btnAddSprintInProject');
      
      if (btnAddTaskInProject) {
        btnAddTaskInProject.addEventListener('click', () => {
          openModal(taskModal);
          // Pré-selecionar o projeto atual
          const projectId = document.getElementById('projectSelector').value;
          if (projectId) {
            document.getElementById('taskProject').value = projectId;
            currentProjectId = projectId;
          }
          // Limpar outros campos
          document.getElementById('taskTitle').value = '';
          document.getElementById('taskDescription').value = '';
        });
      }
      
      if (btnAddSprintInProject) {
        btnAddSprintInProject.addEventListener('click', () => {
          openModal(sprintModal);
          // Pré-selecionar o projeto atual
          const projectId = document.getElementById('projectSelector').value;
          if (projectId) {
            document.getElementById('sprintProject').value = projectId;
            currentProjectId = projectId;
          }
          // Limpar outros campos
          document.getElementById('sprintName').value = '';
          
          // Definir datas padrão (hoje e duas semanas depois)
          const today = new Date();
          const twoWeeksLater = new Date();
          twoWeeksLater.setDate(today.getDate() + 14);
          
          document.getElementById('sprintStartDate').value = today.toISOString().split('T')[0];
          document.getElementById('sprintEndDate').value = twoWeeksLater.toISOString().split('T')[0];
        });
      }
      
      // Botões para fechar modais
      document.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', () => closeModal(btn.closest('.modal')));
      });
      
      // Botões para cancelar ações nos modais
      const cancelTaskBtn = document.getElementById('cancelTaskBtn');
      const cancelSprintBtn = document.getElementById('cancelSprintBtn');
      const cancelProjectBtn = document.getElementById('cancelProjectBtn');
      
      if (cancelTaskBtn) cancelTaskBtn.addEventListener('click', () => closeModal(taskModal));
      if (cancelSprintBtn) cancelSprintBtn.addEventListener('click', () => closeModal(sprintModal));
      if (cancelProjectBtn) cancelProjectBtn.addEventListener('click', () => closeModal(projectModal));
      
      // Submissão de formulários
      if (taskForm) taskForm.addEventListener('submit', handleTaskSubmit);
      if (sprintForm) sprintForm.addEventListener('submit', handleSprintSubmit);
      if (projectForm) projectForm.addEventListener('submit', handleProjectSubmit);
      
      // Filtros no Kanban
      if (sprintFilter) sprintFilter.addEventListener('change', filterTasks);
      if (projectFilter) projectFilter.addEventListener('change', filterTasks);
      if (statusFilter) statusFilter.addEventListener('change', filterTasks);
      if (priorityFilter) priorityFilter.addEventListener('change', filterTasks);
      
      // Seletor de projetos na visualização de projetos
      const projectSelector = document.getElementById('projectSelector');
      if (projectSelector) {
        projectSelector.addEventListener('change', () => {
          currentProjectId = projectSelector.value;
          loadProjectDetails();
        });
      }
      
      // Botões de navegação
      navItems.forEach(button => {
        button.addEventListener('click', () => {
          // Remover classe active de todos os botões
          navItems.forEach(btn => {
            btn.classList.remove('active');
          });
          
          // Adicionar classe active ao botão clicado
          button.classList.add('active');
          
          // Esconder todas as views
          views.forEach(view => {
            view.classList.remove('active');
          });
          
          // Mostrar a view correspondente
          const viewId = button.getAttribute('data-view') + 'View';
          const viewElement = document.getElementById(viewId);
          if (viewElement) {
            viewElement.classList.add('active');
            
            // Carregar dados específicos da view
            if (viewId === 'burndownView') {
              loadBurndownChart();
            } else if (viewId === 'velocityView') {
              loadVelocityChart();
            } else if (viewId === 'projectsView') {
              loadProjects();
            }
          }
        });
      });
    }
    
    // Event listeners para botões de navegação
    navItems.forEach(button => {
      button.addEventListener('click', () => {
        // Remover classe active de todos os botões
        document.querySelectorAll('.agile-nav-item').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Adicionar classe active ao botão clicado
        button.classList.add('active');
        
        // Esconder todas as views
        document.querySelectorAll('.agile-view').forEach(view => {
          view.classList.remove('active');
        });
        
        // Mostrar a view correspondente
        const viewId = button.getAttribute('data-view') + 'View';
        document.getElementById(viewId).classList.add('active');
        
        // Carregar dados específicos da view
        if (viewId === 'burndownView') {
          loadBurndownChart();
        } else if (viewId === 'velocityView') {
          loadVelocityChart();
        } else if (viewId === 'projectsView') {
          loadProjects();
        }
      });
    });
    
    // Funções de navegação
    function switchView(view) {
      currentView = view;
      
      // Atualiza classes ativas
      navItems.forEach(item => {
        if (item.getAttribute('data-view') === view) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
      
      views.forEach(viewEl => {
        if (viewEl.id === `${view}View`) {
          viewEl.classList.add('active');
        } else {
          viewEl.classList.remove('active');
        }
      });
      
      // Atualiza gráficos se necessário
      if (view === 'burndown' && burndownChart) {
        updateBurndownChart();
      } else if (view === 'velocity' && velocityChart) {
        updateVelocityChart();
      }
    }
    
    // Funções de API
    async function fetchAPI(endpoint, method = 'GET', data = null) {
      try {
        console.log(`Iniciando requisição para: ${endpoint} [${method}]`);
        
        // Garantir que o endpoint comece com / e não tenha barras duplas
        if (!endpoint.startsWith('/')) {
          endpoint = '/' + endpoint;
        }
        
        // Construir URL corretamente
        let url = API_URL;
        if (url.endsWith('/') && endpoint.startsWith('/')) {
          url = url + endpoint.substring(1);
        } else if (!url.endsWith('/') && !endpoint.startsWith('/')) {
          url = url + '/' + endpoint;
        } else {
          url = url + endpoint;
        }
        
        console.log('Chamando API:', url);
        
        // Adicionar modo 'cors' para lidar com problemas de CORS
        const options = {
          method,
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          credentials: 'omit' // Não enviar cookies para evitar problemas de CORS
        };
        
        if (data) {
          options.body = JSON.stringify(data);
          console.log('Dados enviados:', data);
          console.log('Body da requisição (JSON):', options.body);
        }
        
        console.log('Opções completas da requisição:', {
          url,
          method: options.method,
          headers: options.headers,
          mode: options.mode
        });
        
        // Verificar se estamos em modo de teste/desenvolvimento
        const DEV_MODE = false; // Usando a API real para testes
        
        if (DEV_MODE) {
          // Simular dados para teste se a API não estiver disponível
          if (endpoint === '/projects' && method === 'GET') {
            console.log('Usando dados simulados para projetos');
            return [{
              id: 1,
              name: 'Projeto Demo',
              description: 'Um projeto de demonstração para testes',
              status: 'Ativo',
              created_at: new Date().toISOString()
            }];
          }
          
          if (endpoint === '/projects' && method === 'POST') {
            console.log('Simulando criação de projeto');
            const projectData = JSON.parse(options.body);
            return {
              id: Math.floor(Math.random() * 1000) + 2,
              name: projectData.name,
              description: projectData.description,
              status: projectData.status,
              created_at: new Date().toISOString()
            };
          }
        }
        
        if (endpoint.includes('/projects/') && endpoint.includes('/sprints')) {
          console.log('Usando dados simulados para sprints do projeto');
          return [];
        }
        
        if (endpoint.includes('/projects/') && endpoint.includes('/tasks')) {
          console.log('Usando dados simulados para tarefas do projeto');
          return [];
        }
        
        if (endpoint.startsWith('/projects/') && !endpoint.includes('/sprints') && !endpoint.includes('/tasks')) {
          console.log('Usando dados simulados para detalhes do projeto');
          const projectId = endpoint.split('/')[2];
          return {
            id: parseInt(projectId),
            name: 'Projeto ' + projectId,
            description: 'Descrição do projeto ' + projectId,
            status: 'Ativo',
            created_at: new Date().toISOString()
          };
        }
        
        // Tentar fazer a chamada real à API
        console.log('Enviando requisição para:', url);
        const response = await fetch(url, options);
        console.log('Resposta recebida status:', response.status);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error(`Erro API (${response.status}):`, errorText);
          showMessage(`Erro na API: ${response.status}`, 'error');
          throw new Error(`Erro API: ${response.status} - ${errorText}`);
        }
        
        const contentType = response.headers.get('content-type');
        console.log('Content-Type da resposta:', contentType);
        
        if (contentType && contentType.includes('application/json')) {
          const result = await response.json();
          console.log('Resposta da API (JSON):', result);
          return result;
        } else {
          const textResult = await response.text();
          console.log('Resposta da API (texto):', textResult);
          return textResult.length > 0 ? { message: textResult } : {};
        }
      } catch (error) {
        console.error(`Erro ao chamar API (${endpoint}):`, error);
        
        // Usar dados simulados em caso de erro CORS
        if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
          showMessage('Usando dados simulados devido a problemas de conexão', 'info');
          
          if (endpoint === '/sprints') {
            return [];
          }
          
          if (endpoint === '/tasks') {
            return [];
          }
          
          if (endpoint === '/projects' && method === 'GET') {
            return [{
              id: 1,
              name: 'Projeto Demo (Simulado)',
              description: 'Projeto simulado devido a erro de conexão',
              status: 'Ativo',
              created_at: new Date().toISOString()
            }];
          }
        } else {
          showMessage(`Erro ao chamar API: ${error.message}`, 'error');
          throw error;
        }
      }
    }
    
    async function createTask(taskData) {
      return await fetchAPI('/tasks', 'POST', taskData);
    }
    
    async function updateTask(taskId, taskData) {
      return await fetchAPI(`/tasks/${taskId}`, 'PUT', taskData);
    }
    
    async function createSprint(sprintData) {
      return await fetchAPI('/sprints', 'POST', sprintData);
    }
    
    async function createProject(projectData) {
      console.log('Chamando endpoint para criar projeto');
      return await fetchAPI('/projects', 'POST', projectData);
    }
    
    // Função para carregar detalhes de um projeto
    async function loadProjectDetails() {
      const projectId = currentProjectId || document.getElementById('projectSelector').value;
      console.log('Carregando detalhes do projeto:', projectId);
      
      if (!projectId) {
        console.log('Nenhum projeto selecionado');
        document.getElementById('projectDetails').style.display = 'none';
        return;
      }
      
      // Atualizar o seletor de projetos se necessário
      const projectSelector = document.getElementById('projectSelector');
      if (projectSelector && projectSelector.value !== projectId) {
        projectSelector.value = projectId;
      }
      
      try {
        // Carregar detalhes do projeto
        const project = await fetchAPI(`/projects/${projectId}`);
        
        // Preencher informações do projeto
        document.getElementById('projectName').textContent = project.name;
        document.getElementById('projectDescription').textContent = project.description || 'Sem descrição';
        
        // Exibir datas de início e término do projeto
        const startDateDisplay = document.querySelector('#projectStartDateDisplay span');
        const endDateDisplay = document.querySelector('#projectEndDateDisplay span');
        
        if (project.start_date) {
          startDateDisplay.textContent = formatDate(project.start_date);
        } else {
          startDateDisplay.textContent = 'Não definido';
        }
        
        if (project.end_date) {
          endDateDisplay.textContent = formatDate(project.end_date);
        } else {
          endDateDisplay.textContent = 'Não definido';
        }
        
        // Carregar sprints do projeto
        const sprints = await fetchAPI(`/projects/${projectId}/sprints`);
        
        // Exibir sprints
        const sprintsContainer = document.getElementById('projectSprints');
        if (sprints.length === 0) {
          sprintsContainer.innerHTML = '<p>Nenhum sprint encontrado para este projeto.</p>';
        } else {
          sprintsContainer.innerHTML = '';
          sprints.forEach(sprint => {
            const sprintEl = document.createElement('div');
            sprintEl.className = 'project-sprint-item';
            sprintEl.innerHTML = `
              <div class="sprint-header">
                <h4>${sprint.name}</h4>
                <span class="sprint-dates">${formatDate(sprint.start_date)} - ${formatDate(sprint.end_date)}</span>
                <span class="sprint-status ${sprint.status.toLowerCase()}">${sprint.status}</span>
              </div>
            `;
            // Adicionar evento de clique para editar o sprint
            sprintEl.addEventListener('click', () => {
              // Implementar futuramente a edição de sprint
              // editSprint(sprint.id);
            });
            sprintsContainer.appendChild(sprintEl);
          });
        }
        
        // Carregar tarefas do projeto
        const tasks = await fetchAPI(`/projects/${projectId}/tasks`);
        
        // Exibir tarefas
        const tasksContainer = document.getElementById('projectTasks');
        if (tasks.length === 0) {
          tasksContainer.innerHTML = '<p>Nenhuma tarefa encontrada para este projeto.</p>';
        } else {
          tasksContainer.innerHTML = '';
          tasks.forEach(task => {
            const taskEl = document.createElement('div');
            taskEl.className = `project-task-item ${task.status.toLowerCase().replace(' ', '-')}`;
            taskEl.innerHTML = `
              <div class="task-header">
                <h4>${task.title}</h4>
                <span class="task-priority ${task.priority.toLowerCase()}">${task.priority}</span>
              </div>
              <p>${task.description || 'Sem descrição'}</p>
              <div class="task-footer">
                <span class="task-status">${task.status}</span>
                <span class="task-points">${task.points} pontos</span>
              </div>
            `;
            // Adicionar evento de clique para editar a tarefa
            taskEl.addEventListener('click', () => {
              // Implementar futuramente a edição de tarefa
              // editTask(task.id);
            });
            tasksContainer.appendChild(taskEl);
          });
        }
        
        // Mostrar detalhes do projeto
        document.getElementById('projectDetails').style.display = 'block';
        
        // Habilitar botões de ação dentro do projeto
        const btnAddTaskInProject = document.getElementById('btnAddTaskInProject');
        const btnAddSprintInProject = document.getElementById('btnAddSprintInProject');
        if (btnAddTaskInProject) btnAddTaskInProject.style.display = 'inline-block';
        if (btnAddSprintInProject) btnAddSprintInProject.style.display = 'inline-block';
      } catch (error) {
        console.error('Erro ao carregar detalhes do projeto:', error);
        document.getElementById('projectDetails').style.display = 'none';
      }
    }
    
    // Carregamento de dados
    async function loadTasks() {
      const data = await fetchAPI('/tasks');
      if (data) {
        tasks = data;
        renderKanban();
      }
    }
    
    async function loadSprints() {
      const data = await fetchAPI('/sprints');
      if (data) {
        sprints = data;
        populateSprintSelects();
      }
    }
    
    async function loadProjects() {
      try {
        console.log('Carregando projetos da API...');
        const data = await fetchAPI('/projects');
        
        if (data) {
          console.log('Projetos recebidos:', data);
          projects = data;
          
          // Preencher seletores
          populateProjectSelects();
          
          // Exibir na aba de projetos
          const projectsList = document.getElementById('projectsList');
          if (projectsList) {
            projectsList.innerHTML = '';
            
            if (projects.length === 0) {
              projectsList.innerHTML = '<div class="empty-state"><p>Nenhum projeto encontrado. Clique em "+Projeto" para criar um novo.</p></div>';
            } else {
              // Criar cards para cada projeto
              projects.forEach(project => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.dataset.id = project.id;
                
                // Calcular progresso (simulado até implementarmos cálculo real)
                const progress = Math.floor(Math.random() * 100);
                
                const statusClass = project.status === 'Ativo' ? 'active' : 
                                  (project.status === 'Concluído' ? 'completed' : 'paused');
                
                card.innerHTML = `
                  <div class="project-card-header">
                    <h3>${project.name}</h3>
                    <span class="project-status ${statusClass}">${project.status}</span>
                  </div>
                  <p class="project-description">${project.description || 'Sem descrição'}</p>
                  <div class="project-dates">
                    <span>Início: ${project.start_date ? formatDate(project.start_date) : 'Não definido'}</span>
                    <span>Término: ${project.end_date ? formatDate(project.end_date) : 'Não definido'}</span>
                  </div>
                  <div class="project-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                    <span>${progress}% concluído</span>
                  </div>
                  <div class="project-actions">
                    <button class="agile-button view-project" data-project-id="${project.id}">Visualizar</button>
                    <button class="agile-button edit-project" data-project-id="${project.id}">Editar</button>
                  </div>
                `;
                
                // Adicionar evento para o botão de visualizar projeto
                card.querySelector('.view-project').addEventListener('click', () => {
                  // Redirecionar para a visualização detalhada do projeto
                  currentProjectId = project.id;
                  loadProjectDetails();
                  switchView('projectDetail');
                });
                
                // Adicionar evento para o botão de editar projeto
                card.querySelector('.edit-project').addEventListener('click', () => {
                  // Abrir modal de edição de projeto (implementar futuramente)
                  console.log('Editar projeto:', project.id);
                });
                
                projectsList.appendChild(card);
              });
            }
          }
        }
      } catch (error) {
        console.error('Erro ao carregar projetos:', error);
        showMessage('Erro ao carregar projetos. Verifique o console para mais detalhes.', 'error');
      }
    }
    
    // Renderização do Kanban
    function renderKanban() {
      const todoList = document.getElementById('todoList');
      const doingList = document.getElementById('doingList');
      const doneList = document.getElementById('doneList');
      
      // Limpa as listas
      todoList.innerHTML = '';
      doingList.innerHTML = '';
      doneList.innerHTML = '';
      
      // Filtra tarefas conforme seleção
      const sprintId = sprintFilter.value ? parseInt(sprintFilter.value) : null;
      const projectName = projectFilter.value;
      const priority = priorityFilter.value;
      
      let filteredTasks = [...tasks];
      
      if (sprintId) {
        filteredTasks = filteredTasks.filter(task => task.sprint_id === sprintId);
      }
      
      if (projectName) {
        filteredTasks = filteredTasks.filter(task => task.project === projectName);
      }
      
      if (priority) {
        filteredTasks = filteredTasks.filter(task => task.priority === priority);
      }
      
      // Conta tarefas por status
      let todoCount = 0;
      let doingCount = 0;
      let doneCount = 0;
      
      // Renderiza tarefas
      filteredTasks.forEach(task => {
        const taskElement = createTaskElement(task);
        
        // Mapear status em inglês para português se necessário
        const status = task.status === 'To Do' ? 'A Fazer' : 
                       task.status === 'Doing' ? 'Em Andamento' : 
                       task.status === 'Done' ? 'Concluído' : task.status;
        
        if (status === 'A Fazer' || task.status === 'To Do') {
          todoList.appendChild(taskElement);
          todoCount++;
        } else if (status === 'Em Andamento' || task.status === 'Doing') {
          doingList.appendChild(taskElement);
          doingCount++;
        } else if (status === 'Concluído' || task.status === 'Done') {
          doneList.appendChild(taskElement);
          doneCount++;
        }
      });
      
      // Atualiza contadores
      document.getElementById('todoCount').textContent = todoCount;
      document.getElementById('doingCount').textContent = doingCount;
      document.getElementById('doneCount').textContent = doneCount;
    }
    
    function createTaskElement(task) {
      const taskEl = document.createElement('div');
      taskEl.className = 'kanban-task';
      taskEl.setAttribute('data-id', task.id);
      
      // Define a cor da borda baseada na prioridade
      if (task.priority === 'Alta') {
        taskEl.style.borderLeftColor = '#f44336';
      } else if (task.priority === 'Média') {
        taskEl.style.borderLeftColor = '#ff9800';
      } else {
        taskEl.style.borderLeftColor = '#4caf50';
      }
      
      // Encontra o nome do sprint se existir
      let sprintName = '';
      if (task.sprint_id) {
        const sprint = sprints.find(s => s.id === task.sprint_id);
        if (sprint) {
          sprintName = sprint.name;
        }
      }
      
      taskEl.innerHTML = `
        <div class="kanban-task-title">${task.title}</div>
        <div class="kanban-task-desc">${task.description || ''}</div>
        <div class="kanban-task-meta">
          <span>${task.project || ''}</span>
          <span>${sprintName}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 1rem; align-items: center;">
          <span class="kanban-task-priority priority-${task.priority.toLowerCase()}">
            ${task.priority}
          </span>
          ${task.points ? `<span class="kanban-task-points">${task.points}</span>` : ''}
        </div>
      `;
      
      // Adiciona eventos
      taskEl.addEventListener('click', () => editTask(task.id));
      
      return taskEl;
    }
    
    // Inicializa Sortable.js para arrastar e soltar
    function initKanbanSortable() {
      const columns = document.querySelectorAll('.kanban-task-list');
      
      columns.forEach(column => {
        new Sortable(column, {
          group: 'kanban',
          animation: 150,
          ghostClass: 'kanban-task-ghost',
          onEnd: async function(evt) {
            const taskId = parseInt(evt.item.getAttribute('data-id'));
            const newStatus = evt.to.id === 'todoList' ? 'A Fazer' : 
                           evt.to.id === 'doingList' ? 'Em Andamento' : 'Concluído';
            
            // Atualiza o status da tarefa na API
            const task = tasks.find(t => t.id === taskId);
            if (task && task.status !== newStatus) {
              const updates = { status: newStatus };
              
              // Se moveu para Em Andamento e não tem data de início, define agora
              if (newStatus === 'Em Andamento' && !task.started_at) {
                updates.started_at = new Date().toISOString();
              }
              
              // Se moveu para Concluído e não tem data de conclusão, define agora
              if (newStatus === 'Concluído' && !task.completed_at) {
                updates.completed_at = new Date().toISOString();
              }
              
              // Se moveu de Done para outro status, remove a data de conclusão
              if (task.status === 'Done' && newStatus !== 'Done') {
                updates.completed_at = null;
              }
              
              await updateTask(taskId, updates);
              await loadTasks(); // Recarrega para obter dados atualizados
            }
          }
        });
      });
    }
    
    // Manipulação de tarefas
    function openTaskModal(task = null) {
      const modalTitle = document.getElementById('taskModalTitle');
      const taskId = document.getElementById('taskId');
      const taskTitle = document.getElementById('taskTitle');
      const taskDescription = document.getElementById('taskDescription');
      const taskStatus = document.getElementById('taskStatus');
      const taskProject = document.getElementById('taskProject');
      const taskSprint = document.getElementById('taskSprint');
      const taskPoints = document.getElementById('taskPoints');
      const taskPriority = document.getElementById('taskPriority');
      
      // Limpa o formulário
      taskForm.reset();
      
      if (task) {
        // Modo edição
        modalTitle.textContent = 'Editar Tarefa';
        taskId.value = task.id;
        taskTitle.value = task.title;
        taskDescription.value = task.description || '';
        taskStatus.value = task.status;
        taskProject.value = task.project || '';
        taskSprint.value = task.sprint_id || '';
        taskPoints.value = task.points || '';
        taskPriority.value = task.priority;
      } else {
        // Modo criação
        modalTitle.textContent = 'Nova Tarefa';
        taskId.value = '';
      }
      
      taskModal.classList.add('active');
    }
    
    function closeTaskModalFn() {
      taskModal.classList.remove('active');
    }
    
    async function handleTaskSubmit(event) {
      event.preventDefault();
      
      // Obter os valores dos campos
      const title = document.getElementById('taskTitle').value;
      const description = document.getElementById('taskDescription').value;
      const status = document.getElementById('taskStatus').value;
      const priority = document.getElementById('taskPriority').value;
      const points = parseInt(document.getElementById('taskPoints').value) || 0;
      const projectId = document.getElementById('taskProject').value || currentProjectId;
      const sprintId = document.getElementById('taskSprint').value || null;
      
      // Validar título da tarefa
      if (!title.trim()) {
        showMessage('O título da tarefa é obrigatório', 'error');
        return;
      }
      
      // Criar objeto de dados da tarefa
      const taskData = {
        title: title,
        description: description,
        status: status,
        priority: priority,
        points: points,
        project: projectId,
        sprint_id: sprintId
      };
      
      // Se a tarefa está associada a um sprint, verificar se as datas estão dentro do período do sprint
      if (sprintId) {
        try {
          // Obter detalhes do sprint
          const sprint = await fetchAPI(`/sprints/${sprintId}`);
          
          // Definir datas com base no status da tarefa
          let startDate = null;
          let endDate = null;
          
          if (status === 'Em Andamento' || status === 'Concluído') {
            startDate = new Date(); // Data atual como início se estiver em andamento ou concluída
          }
          
          if (status === 'Concluído') {
            endDate = new Date(); // Data atual como conclusão se estiver concluída
          }
          
          // Verificar se as datas estão dentro do período do sprint
          if (startDate && sprint.start_date && startDate < new Date(sprint.start_date)) {
            showMessage('Atenção: A data de início da tarefa será ajustada para a data de início do sprint', 'info');
            startDate = new Date(sprint.start_date);
          }
          
          if (endDate && sprint.end_date && endDate > new Date(sprint.end_date)) {
            showMessage('Atenção: A data de conclusão da tarefa será ajustada para a data de término do sprint', 'info');
            endDate = new Date(sprint.end_date);
          }
          
          // Adicionar datas ao objeto de dados da tarefa
          if (startDate) {
            taskData.started_at = startDate.toISOString();
          }
          
          if (endDate) {
            taskData.completed_at = endDate.toISOString();
          }
          
        } catch (error) {
          console.error('Erro ao verificar datas do sprint:', error);
        }
      }
      
      try {
        if (editingTaskId) {
          await updateTask(editingTaskId, taskData);
          showMessage('Tarefa atualizada com sucesso!', 'success');
        } else {
          await createTask(taskData);
          showMessage('Tarefa criada com sucesso!', 'success');
        }
        
        closeModal(taskModal);
        await loadTasks();
        
        // Se estiver na visualização de projetos, recarregar os detalhes do projeto
        if (document.getElementById('projectsView').classList.contains('active') && projectId) {
          currentProjectId = projectId;
          await loadProjectDetails();
        }
        
        taskForm.reset();
        editingTaskId = null;
      } catch (error) {
        showMessage('Erro ao salvar tarefa', 'error');
        console.error(error);
      }
    }
    
    async function handleProjectSubmit(event) {
      event.preventDefault();
      
      // Obter os elementos do DOM e verificar se existem
      const nameElement = document.getElementById('projectNameInput');
      const descriptionElement = document.getElementById('projectDescription');
      const statusElement = document.getElementById('projectStatus');
      const startDateElement = document.getElementById('projectStartDate');
      const endDateElement = document.getElementById('projectEndDate');
      
      // Verificar se os elementos foram encontrados
      if (!nameElement) {
        console.error('Elemento #projectName não encontrado no DOM');
        showMessage('Erro ao processar formulário: Elemento #projectName não encontrado', 'error');
        return;
      }
      
      // Obter os valores dos campos
      const name = nameElement.value;
      const description = descriptionElement ? descriptionElement.value : '';
      const status = statusElement ? statusElement.value : 'Ativo';
      const startDate = startDateElement ? startDateElement.value : '';
      const endDate = endDateElement ? endDateElement.value : '';
      
      console.log('Dados do projeto:', { name, description, status, startDate, endDate });
      
      // Validar nome do projeto
      if (!name || !name.trim()) {
        showMessage('O nome do projeto é obrigatório', 'error');
        return;
      }
      
      // Validar datas se ambas estiverem preenchidas
      if (startDate && endDate && new Date(startDate) > new Date(endDate)) {
        showMessage('A data de início não pode ser posterior à data de término', 'error');
        return;
      }
      
      const projectData = {
        name: name,
        description: description,
        status: status,
        start_date: startDate || null,
        end_date: endDate || null
      };
      
      console.log('Criando novo projeto:', projectData);
      
      try {
        const result = await createProject(projectData);
        console.log('Projeto criado com sucesso:', result);
        showMessage('Projeto criado com sucesso!', 'success');
        
        closeModal(projectModal);
        
        // Recarregar projetos
        await loadProjects();
        
        // Recarregar seletores de projetos nos formulários
        // Atualizar todos os seletores de projetos na página
        const projectSelectors = document.querySelectorAll('select[data-type="project-selector"]');
        if (projectSelectors.length > 0) {
          try {
            // Buscar projetos da API
            const projects = await fetchAPI('/projects');
            
            // Preencher cada seletor com os projetos
            projectSelectors.forEach(selector => {
              // Salvar valor atual
              const currentValue = selector.value;
              
              // Limpar opções atuais
              selector.innerHTML = '<option value="">Selecione um projeto</option>';
              
              // Adicionar novos projetos
              projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                selector.appendChild(option);
              });
              
              // Restaurar valor se possível
              if (currentValue) {
                selector.value = currentValue;
              }
            });
          } catch (error) {
            console.error('Erro ao carregar projetos para seletores:', error);
          }
        }
        
        document.getElementById('projectForm').reset();
      } catch (error) {
        console.error('Erro ao criar projeto:', error);
        showMessage(`Erro ao criar projeto: ${error.message}`, 'error');
      }
    }
    
    async function handleSprintSubmit(event) {
      event.preventDefault();
      
      const projectId = document.getElementById('sprintProject').value || currentProjectId;
      
      // Obter os valores dos campos de data
      const startDate = document.getElementById('sprintStartDate').value;
      const endDate = document.getElementById('sprintEndDate').value;
      
      // Validar datas
      if (!startDate || !endDate) {
        showMessage('As datas de início e término são obrigatórias', 'error');
        return;
      }
      
      if (new Date(startDate) > new Date(endDate)) {
        showMessage('A data de início não pode ser posterior à data de término', 'error');
        return;
      }
      
      // Verificar se as datas estão dentro do período do projeto
      if (projectId) {
        try {
          const project = await fetchAPI(`/projects/${projectId}`);
          
          if (project.start_date && new Date(startDate) < new Date(project.start_date)) {
            showMessage('A data de início do sprint não pode ser anterior à data de início do projeto', 'error');
            return;
          }
          
          if (project.end_date && new Date(endDate) > new Date(project.end_date)) {
            showMessage('A data de término do sprint não pode ser posterior à data de término do projeto', 'error');
            return;
          }
        } catch (error) {
          console.error('Erro ao verificar datas do projeto:', error);
        }
      }
      
      const sprintData = {
        name: document.getElementById('sprintName').value,
        start_date: startDate,
        end_date: endDate,
        project_id: projectId
      };
      
      try {
        await createSprint(sprintData);
        showMessage('Sprint criado com sucesso!', 'success');
        
        closeModal(sprintModal);
        await loadSprints();
        
        // Se estiver na visualização de projetos, recarregar os detalhes do projeto
        if (document.getElementById('projectsView').classList.contains('active') && projectId) {
          currentProjectId = projectId;
          await loadProjectDetails();
        }
        
        document.getElementById('sprintForm').reset();
      } catch (error) {
        showMessage('Erro ao criar sprint', 'error');
        console.error(error);
      }
    }
    
    async function createTask(taskData) {
      return await fetchAPI('/tasks', 'POST', taskData);
    }
    
    async function updateTask(taskId, taskData) {
      return await fetchAPI(`/tasks/${taskId}`, 'PUT', taskData);
    }
    
    async function deleteTask(taskId) {
      if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
        await fetchAPI(`/tasks/${taskId}`, 'DELETE');
        await loadTasks();
      }
    }
    
    function editTask(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        openTaskModal(task);
      }
    }
    
    // Manipulação de sprints
    function openSprintModal() {
      sprintForm.reset();
      sprintModal.classList.add('active');
    }
    
    function closeSprintModalFn() {
      sprintModal.classList.remove('active');
    }
    
    // Manipulau00e7u00e3o de projetos
    async function handleProjectSubmit(event) {
      event.preventDefault();
      
      const nameElement = document.getElementById('projectNameInput');
      const name = nameElement.value;
      
      if (!name || !name.trim()) {
        showMessage('O nome do projeto u00e9 obrigatu00f3rio', 'error');
        return;
      }
      
      const descriptionElement = document.getElementById('projectDescription');
      const statusElement = document.getElementById('projectStatus');
      const startDateElement = document.getElementById('projectStartDate');
      const endDateElement = document.getElementById('projectEndDate');
      
      const projectData = {
        name: name.trim(),
        description: descriptionElement && descriptionElement.value ? descriptionElement.value.trim() : '',
        status: statusElement && statusElement.value ? statusElement.value : 'Ativo',
        start_date: startDateElement && startDateElement.value ? startDateElement.value : null,
        end_date: endDateElement && endDateElement.value ? endDateElement.value : null
      };
      
      console.log('Criando novo projeto:', projectData);
      
      try {
        const result = await createProject(projectData);
        console.log('Projeto criado com sucesso:', result);
        showMessage('Projeto criado com sucesso!', 'success');
        
        closeModal(projectModal);
        
        // Recarregar projetos
        await loadProjects();
        
        // Recarregar seletores de projetos nos formulu00e1rios
        // Atualizar todos os seletores de projetos na pu00e1gina
        const projectSelectors = document.querySelectorAll('select[data-type="project-selector"]');
        if (projectSelectors.length > 0) {
          try {
            // Buscar projetos da API
            const projects = await fetchAPI('/projects');
            
            // Preencher cada seletor com os projetos
            projectSelectors.forEach(selector => {
              // Salvar valor atual
              const currentValue = selector.value;
              
              // Limpar opu00e7u00f5es atuais
              selector.innerHTML = '<option value="">Selecione um projeto</option>';
              
              // Adicionar novos projetos
              projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                selector.appendChild(option);
              });
              
              // Restaurar valor se possu00edvel
              if (currentValue) {
                selector.value = currentValue;
              }
            });
          } catch (error) {
            console.error('Erro ao carregar projetos para seletores:', error);
          }
        }
        
        document.getElementById('projectForm').reset();
      } catch (error) {
        console.error('Erro ao criar projeto:', error);
        showMessage(`Erro ao criar projeto: ${error.message || 'Erro desconhecido'}`, 'error');
      }
    }
    
    async function createProject(projectData) {
      return await fetchAPI('/projects', 'POST', projectData);
    }
    
    async function handleSprintSubmit(e) {
      e.preventDefault();
      
      const sprintData = {
        name: document.getElementById('sprintName').value,
        start_date: document.getElementById('sprintStartDate').value,
        end_date: document.getElementById('sprintEndDate').value,
        status: 'Ativo'
      };
      
      await createSprint(sprintData);
      closeSprintModalFn();
      await loadSprints();
    }
    
    async function createSprint(sprintData) {
      return await fetchAPI('/sprints', 'POST', sprintData);
    }
    
    // Popula selects
    function populateSprintSelects() {
      const sprintSelects = [
        sprintFilter, 
        document.getElementById('taskSprint'), 
        burndownSprintSelect
      ].filter(select => select !== null && select !== undefined);
      
      sprintSelects.forEach(select => {
        // Verificar se o select existe e tem opções
        if (!select || !select.options || select.options.length === 0) return;
        
        // Mantém a primeira opção (placeholder)
        const firstOption = select.options[0];
        select.innerHTML = '';
        select.appendChild(firstOption);
        
        // Adiciona opções de sprints
        if (Array.isArray(sprints)) {
          sprints.forEach(sprint => {
            const option = document.createElement('option');
            option.value = sprint.id;
            option.textContent = sprint.name;
            select.appendChild(option);
          });
        }
      });
    }
    
    function populateProjectSelects() {
      const projectSelects = [projectFilter, document.getElementById('taskProject'), document.getElementById('sprintProject')];
      
      projectSelects.forEach(select => {
        if (!select) return;
        
        // Mantém a primeira opção (placeholder)
        const firstOption = select.options[0];
        select.innerHTML = '';
        select.appendChild(firstOption);
        
        // Adiciona opções de projetos
        projects.forEach(project => {
          const option = document.createElement('option');
          option.value = project.id;
          option.textContent = project.name;
          select.appendChild(option);
        });
      });
    }
    
    // Filtros
    function filterTasks() {
      renderKanban();
    }
    
    // Gráficos
    function initCharts() {
      // Inicializa gráfico Burndown vazio
      const burndownCtx = document.getElementById('burndownChart').getContext('2d');
      burndownChart = new Chart(burndownCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: []
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          }
        }
      });
      
      // Inicializa gráfico Velocity vazio
      const velocityCtx = document.getElementById('velocityChart').getContext('2d');
      velocityChart = new Chart(velocityCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: []
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          }
        }
      });
      
      // Carrega dados iniciais dos gráficos
      updateVelocityChart();
    }
    
    async function updateBurndownChart() {
      const sprintId = burndownSprintSelect.value;
      if (!sprintId) {
        // Limpa o gráfico se nenhum sprint estiver selecionado
        burndownChart.data.labels = [];
        burndownChart.data.datasets = [];
        burndownChart.update();
        return;
      }
      
      // Busca dados do burndown para o sprint selecionado
      const burndownData = await fetchAPI(`/burndown/${sprintId}`);
      if (!burndownData) return;
      
      // Prepara dados para o gráfico
      const labels = burndownData.map(item => item.date);
      const remainingTasks = burndownData.map(item => item.remaining_tasks);
      const remainingPoints = burndownData.map(item => item.remaining_points);
      
      // Atualiza o gráfico
      burndownChart.data.labels = labels;
      burndownChart.data.datasets = [
        {
          label: burndownMode === 'tasks' ? 'Tarefas Restantes' : 'Pontos Restantes',
          data: burndownMode === 'tasks' ? remainingTasks : remainingPoints,
          borderColor: '#D50032',
          backgroundColor: 'rgba(213, 0, 50, 0.1)',
          borderWidth: 2,
          fill: true,
          tension: 0.1
        }
      ];
      burndownChart.update();
    }
    
    async function updateVelocityChart() {
      // Busca dados de velocity
      const velocityData = await fetchAPI('/velocity');
      if (!velocityData) return;
      
      // Prepara dados para o gráfico
      const labels = velocityData.map(item => item.sprint_name);
      const completedTasks = velocityData.map(item => item.completed_tasks);
      const completedPoints = velocityData.map(item => item.completed_points);
      
      // Atualiza o gráfico
      velocityChart.data.labels = labels;
      velocityChart.data.datasets = [
        {
          label: velocityMode === 'tasks' ? 'Tarefas Concluídas' : 'Pontos Concluídos',
          data: velocityMode === 'tasks' ? completedTasks : completedPoints,
          backgroundColor: 'rgba(213, 0, 50, 0.7)',
          borderWidth: 0
        }
      ];
      velocityChart.update();
    }
    
    function toggleBurndownMode() {
      burndownMode = burndownMode === 'tasks' ? 'points' : 'tasks';
      toggleBurndownView.innerHTML = `<i class="fas fa-exchange-alt"></i> ${burndownMode === 'tasks' ? 'Pontos' : 'Tarefas'}`;
      updateBurndownChart();
    }
    
    function toggleVelocityMode() {
      velocityMode = velocityMode === 'tasks' ? 'points' : 'tasks';
      toggleVelocityView.innerHTML = `<i class="fas fa-exchange-alt"></i> ${velocityMode === 'tasks' ? 'Pontos' : 'Tarefas'}`;
      updateVelocityChart();
    }
  </script>
</body>
</html>
